import { NextResponse } from 'next/server';
import { employerData } from '@/data/employerData';
import { promises as fs } from 'fs';
import path from 'path';

export async function GET(req, { params }) {
    const { code } = params;

    const employer = employerData.find(e => e.access_code === code);
    const employerName = employer?.public_employer_name ?? 'Your Company';

    const filePath = path.join(process.cwd(), 'public', 'templates', 'one-sheet1.html');
    let html = await fs.readFile(filePath, 'utf8');

    html = html
        .replaceAll('{{employerName}}', employerName)
        .replaceAll('{{code}}', code);

    return new NextResponse(html, {
        headers: {
            'Content-Type': 'text/html; charset=utf-8'
        }
    });
}